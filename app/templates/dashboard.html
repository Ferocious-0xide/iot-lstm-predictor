<!-- app/templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Sensor Selection -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Sensor Selection</h2>
        <select class="w-full p-2 border rounded"
                id="sensor-select"
                onchange="updateSensorData(this.value)">
            {% for sensor in sensors %}
            <option value="{{ sensor }}">Sensor {{ sensor }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Current Readings -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Current Readings</h2>
        <div id="current-readings">
            Loading current readings...
        </div>
    </div>

    <!-- Predictions -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Predictions</h2>
        <div id="predictions">
            <div class="animate-pulse">
                Computing predictions...
            </div>
        </div>
    </div>

    <!-- Sensor Stats -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Sensor Statistics</h2>
        <div id="sensor-stats"
             hx-get="/api/v1/sensors/stats"
             hx-trigger="load">
            Loading statistics...
        </div>
    </div>
</div>

<script>
function updateSensorData(sensorId) {
    // Update current readings
    htmx.ajax('GET', `/api/v1/sensors/${sensorId}/readings`, '#current-readings');
    
    // Update predictions
    htmx.ajax('GET', `/api/v1/sensors/${sensorId}/predict`, '#predictions');
}

// Initialize with sensor 1
document.addEventListener('DOMContentLoaded', function() {
    updateSensorData('1');
    
    // Set up periodic refresh for current readings
    setInterval(() => {
        const sensorId = document.getElementById('sensor-select').value;
        htmx.ajax('GET', `/api/v1/sensors/${sensorId}/readings`, '#current-readings');
    }, 5000);
});
</script>
{% endblock %}